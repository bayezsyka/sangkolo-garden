import{r as f,u as v,j as a,H as S,L as D}from"./app-Co9wwUI6.js";import{A as T}from"./AuthenticatedLayout-CkjFgVln.js";import{I as t}from"./InputLabel-Cv6UIkTz.js";import{T as i,I as n}from"./TextInput-DNionwE1.js";import{M as F}from"./Modal-DNo-X71d.js";import{P as B}from"./PhaseStopwatch-DVqjOtSZ.js";import"./transition-Od7C6GRL.js";function $({auth:I,batch:s,server_time:_}){const u=f.useRef(null),[N,o]=f.useState(!1),{data:c,setData:l,post:k,processing:h,errors:r,reset:y}=v({batch_tanam_id:s.id,tanggal:new Date().toISOString().split("T")[0],ppm_nutrisi:"",ph_air:"",suhu_air:"",catatan:"",foto_kondisi:null}),b=e=>{if(!e)return 0;const g=new Date(e),P=Math.abs(new Date-g);return Math.ceil(P/(1e3*60*60*24))},x=s.jurnal_kebuns&&s.jurnal_kebuns.length>0?s.jurnal_kebuns[0]:null,{data:d,setData:m,post:w,processing:j,errors:p,reset:C}=v({batch_id:s.id,total_berat_panen:"",jumlah_panen_layak:s.jumlah_tanaman,jumlah_afkir:0,catatan_panen:""}),M=e=>{e.preventDefault(),k(route("maintenance.store"),{onSuccess:()=>{y("ppm_nutrisi","ph_air","suhu_air","catatan","foto_kondisi"),u.current&&(u.current.value="")}})},L=e=>{e.preventDefault(),w(route("harvest.store"),{onSuccess:()=>{o(!1),C()}})},H=b(s.tanggal_mulai);return a.jsxs(T,{header:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold text-gray-900 tracking-tight",children:"Detail Perawatan"}),a.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[a.jsx("span",{className:"font-mono",children:s.kode_batch})," — ",s.nama_custom||s.master_varietas?.nama_varietas,s.lokasi_saat_ini&&a.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-gray-100 rounded text-[10px] text-gray-500",children:s.lokasi_saat_ini.nama_lokasi})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>o(!0),className:"btn btn-primary text-xs gap-1.5",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})}),"Selesai Panen"]}),a.jsxs(D,{href:route("production.index"),className:"btn btn-ghost text-xs gap-1",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),"Kembali"]})]})]}),children:[a.jsx(S,{title:`Perawatan - ${s.kode_batch}`}),a.jsxs("div",{className:"page-container",children:[a.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6 animate-fade-in-up",style:{opacity:0},children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("p",{className:"stat-label",children:"Umur"}),a.jsxs("p",{className:"stat-value",children:[H,a.jsx("span",{className:"text-sm text-gray-400 font-normal ml-1",children:"hari"})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("p",{className:"stat-label",children:"Jumlah"}),a.jsx("p",{className:"stat-value",children:s.jumlah_tanaman})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("p",{className:"stat-label",children:"PPM Terakhir"}),a.jsx("p",{className:"stat-value",children:x?.ppm_nutrisi||"—"})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("p",{className:"stat-label",children:"pH Terakhir"}),a.jsx("p",{className:"stat-value",children:x?.ph_air||"—"})]})]}),a.jsx("div",{className:"card-flat px-5 py-3 mb-6 animate-fade-in-up stagger-1",style:{opacity:0},children:a.jsx(B,{startTime:s.tanggal_ubah_fase||s.tanggal_mulai,phaseName:"Produksi",serverTime:_})}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[a.jsx("div",{className:"lg:col-span-1 animate-fade-in-up stagger-2",style:{opacity:0},children:a.jsxs("div",{className:"card-flat p-5 sticky top-20",children:[a.jsxs("h3",{className:"text-sm font-bold text-gray-900 mb-4 flex items-center gap-2",children:[a.jsx("div",{className:"w-6 h-6 bg-gray-900 rounded-lg flex items-center justify-center",children:a.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),"Catat Hari Ini"]}),a.jsxs("form",{onSubmit:M,encType:"multipart/form-data",className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(t,{htmlFor:"tanggal",value:"Tanggal"}),a.jsx(i,{id:"tanggal",type:"date",value:c.tanggal,onChange:e=>l("tanggal",e.target.value),className:"input-field mt-1.5",required:!0}),a.jsx(n,{message:r.tanggal,className:"mt-2"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx(t,{htmlFor:"ppm_nutrisi",value:"PPM"}),a.jsx(i,{id:"ppm_nutrisi",type:"number",value:c.ppm_nutrisi,onChange:e=>l("ppm_nutrisi",e.target.value),className:"input-field mt-1.5",placeholder:"1100"}),a.jsx(n,{message:r.ppm_nutrisi,className:"mt-2"})]}),a.jsxs("div",{children:[a.jsx(t,{htmlFor:"ph_air",value:"pH Air"}),a.jsx(i,{id:"ph_air",type:"number",step:"0.1",value:c.ph_air,onChange:e=>l("ph_air",e.target.value),className:"input-field mt-1.5",placeholder:"6.0"}),a.jsx(n,{message:r.ph_air,className:"mt-2"})]})]}),a.jsxs("div",{children:[a.jsx(t,{htmlFor:"catatan",value:"Catatan"}),a.jsx("textarea",{id:"catatan",value:c.catatan,onChange:e=>l("catatan",e.target.value),className:"input-field mt-1.5 h-20 resize-none",placeholder:"Tulis kondisi tanaman..."}),a.jsx(n,{message:r.catatan,className:"mt-2"})]}),a.jsxs("div",{children:[a.jsx(t,{htmlFor:"foto_kondisi",value:"Foto (Opsional)"}),a.jsx("input",{ref:u,id:"foto_kondisi",type:"file",accept:"image/*",onChange:e=>l("foto_kondisi",e.target.files[0]),className:"mt-1.5 block w-full text-xs text-gray-500 file:mr-3 file:py-2 file:px-4 file:rounded-xl file:border-0 file:text-xs file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200 transition-colors"}),a.jsx(n,{message:r.foto_kondisi,className:"mt-2"})]}),a.jsx("button",{type:"submit",disabled:h,className:"btn btn-primary w-full !py-3",children:h?"Menyimpan...":"Simpan Jurnal"})]})]})}),a.jsx("div",{className:"lg:col-span-2 animate-fade-in-up stagger-3",style:{opacity:0},children:a.jsxs("div",{className:"card-flat p-5 min-h-[400px]",children:[a.jsxs("h3",{className:"text-sm font-bold text-gray-900 mb-6 flex items-center gap-2",children:[a.jsx("div",{className:"w-6 h-6 bg-gray-100 rounded-lg flex items-center justify-center",children:a.jsx("svg",{className:"w-3.5 h-3.5 text-gray-500",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),"Riwayat Perawatan"]}),a.jsx("div",{children:s.jurnal_kebuns&&s.jurnal_kebuns.length>0?s.jurnal_kebuns.map((e,g)=>a.jsxs("div",{className:"timeline-item",children:[a.jsx("div",{className:"timeline-dot",children:a.jsx("svg",{fill:"none",stroke:"currentColor",strokeWidth:"2.5",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),a.jsx("div",{className:"mb-1",children:a.jsx("span",{className:"text-xs font-semibold text-gray-900",children:new Date(e.tanggal).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})}),a.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.ppm_nutrisi&&a.jsxs("span",{className:"badge badge-light",children:["PPM: ",e.ppm_nutrisi]}),e.ph_air&&a.jsxs("span",{className:"badge badge-light",children:["pH: ",e.ph_air]})]}),e.catatan&&a.jsx("p",{className:"mt-2 text-sm text-gray-500 leading-relaxed whitespace-pre-wrap",children:e.catatan}),e.foto_kondisi&&a.jsx("div",{className:"mt-3",children:a.jsx("img",{src:`/storage/${e.foto_kondisi}`,alt:"Kondisi",className:"w-20 h-20 object-cover rounded-xl border border-gray-100 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>window.open(`/storage/${e.foto_kondisi}`,"_blank")})})]},e.id)):a.jsxs("div",{className:"empty-state",children:[a.jsx("svg",{className:"empty-icon",fill:"none",stroke:"currentColor",strokeWidth:"1",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})}),a.jsx("span",{className:"empty-text",children:"Belum ada catatan. Mulai catat hari ini!"})]})})]})})]})]}),a.jsx(F,{show:N,onClose:()=>o(!1),children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Konfirmasi Panen"}),a.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Batch ",s.kode_batch," — Masukkan data hasil panen akhir."]})]}),a.jsxs("form",{onSubmit:L,className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(t,{htmlFor:"total_berat_panen",value:"Total Berat (Kg)"}),a.jsx(i,{id:"total_berat_panen",type:"number",step:"0.01",value:d.total_berat_panen,onChange:e=>m("total_berat_panen",e.target.value),className:"input-field mt-1.5",placeholder:"Contoh: 12.5",required:!0}),a.jsx(n,{message:p.total_berat_panen,className:"mt-2"})]}),a.jsxs("div",{children:[a.jsx(t,{htmlFor:"jumlah_panen_layak",value:"Jumlah Layak (Pcs)"}),a.jsx(i,{id:"jumlah_panen_layak",type:"number",value:d.jumlah_panen_layak,onChange:e=>m("jumlah_panen_layak",e.target.value),className:"input-field mt-1.5",required:!0}),a.jsx(n,{message:p.jumlah_panen_layak,className:"mt-2"})]})]}),a.jsxs("div",{children:[a.jsx(t,{htmlFor:"jumlah_afkir",value:"Jumlah Afkir / Rusak"}),a.jsx(i,{id:"jumlah_afkir",type:"number",value:d.jumlah_afkir,onChange:e=>m("jumlah_afkir",e.target.value),className:"input-field mt-1.5"}),a.jsx(n,{message:p.jumlah_afkir,className:"mt-2"})]}),a.jsxs("div",{children:[a.jsx(t,{htmlFor:"catatan_panen",value:"Catatan Panen (Opsional)"}),a.jsx("textarea",{id:"catatan_panen",value:d.catatan_panen,onChange:e=>m("catatan_panen",e.target.value),className:"input-field mt-1.5 h-20 resize-none",placeholder:"Tulis catatan mengenai hasil panen..."}),a.jsx(n,{message:p.catatan_panen,className:"mt-2"})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[a.jsx("button",{type:"button",onClick:()=>o(!1),className:"btn btn-secondary",children:"Batal"}),a.jsx("button",{type:"submit",disabled:j,className:"btn btn-primary",children:j?"Menyimpan...":"Simpan & Selesaikan"})]})]})]})})]})}export{$ as default};
