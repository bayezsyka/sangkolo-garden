import{r as m,u as d,j as a,H as oa}from"./app-Co9wwUI6.js";import{A as da}from"./AuthenticatedLayout-CkjFgVln.js";import{M as g}from"./Modal-DNo-X71d.js";import{I as n}from"./InputLabel-Cv6UIkTz.js";import{T as l,I as r}from"./TextInput-DNionwE1.js";import{P as ca}from"./PhaseStopwatch-DVqjOtSZ.js";import"./transition-Od7C6GRL.js";function ka({auth:ha,batches:v,varieties:ua,locations:_,server_time:H}){const[I,c]=m.useState(!1),[K,h]=m.useState(!1),[W,u]=m.useState(!1),[q,x]=m.useState(!1),[t,o]=m.useState(null),[p,z]=m.useState(null),A=new Date().toLocaleDateString("id-ID",{day:"numeric",month:"short"}),{data:j,setData:f,post:J,processing:P,errors:b,reset:O}=d({nama_tanaman:`Batch ${A}`,jumlah_tanaman:"100",tanggal_tanam:new Date().toISOString().slice(0,16),nama_lokasi:""}),{data:w,setData:k,put:V,processing:M,errors:C,reset:R}=d({nama_custom:"",jumlah_tanaman:""}),{data:S,setData:N,post:U,processing:B,errors:D,reset:$}=d({batch_id:"",lokasi_tujuan_id:"",jumlah_tanaman_hidup:""}),{data:G,setData:E,put:Q,processing:F,errors:X,reset:Y}=d({next_phase:"",nama_lokasi:""}),{put:xa,delete:Z,processing:y}=d(),aa=e=>{e.preventDefault();const i=new Date,s=i.getTimezoneOffset()*6e4,ma=new Date(i-s).toISOString().slice(0,16);J(route("nursery.store"),{data:{...j,tanggal_tanam:ma},onSuccess:()=>{c(!1),O()}})},T=e=>e.nama_custom||e.master_varietas?.nama_varietas||"Tanaman",L=(e,i)=>{o(e),z(i),E({next_phase:i,nama_lokasi:""}),h(!0)},ea=e=>{e.preventDefault(),Q(route("nursery.update_phase",t.id),{onSuccess:()=>{h(!1),Y(),o(null)}})},sa=e=>{o(e),k({nama_custom:e.nama_custom||e.master_varietas?.nama_varietas||"",jumlah_tanaman:e.jumlah_tanaman}),u(!0)},ta=e=>{e.preventDefault(),V(route("nursery.update",t.id),{onSuccess:()=>{u(!1),R()}})},na=e=>{confirm("Apakah Anda yakin ingin menghapus batch ini? Semua riwayat akan hilang.")&&Z(route("nursery.destroy",e))},ra=e=>{o(e),N({batch_id:e.id,lokasi_tujuan_id:"",jumlah_tanaman_hidup:e.jumlah_tanaman}),x(!0)},ia=e=>{e.preventDefault(),U(route("production.store_pindah_tanam"),{onSuccess:()=>{x(!1),$(),o(null)}})},la=[{key:"persiapan_benih",title:"Perendaman",step:"01",items:v.persiapan_benih||[],nextPhaseTarget:"peram",nextPhaseLabel:"Mulai Peram",prevPhaseTarget:null,isTransfer:!1,phaseKey:"semai"},{key:"peram",title:"Pemeraman",step:"02",items:v.peram||[],nextPhaseTarget:"semai_tray",nextPhaseLabel:"Pindah ke Tray",prevPhaseTarget:"persiapan_benih",isTransfer:!1,phaseKey:"pemeraman"},{key:"semai_tray",title:"Semai Tray",step:"03",items:v.semai_tray||[],nextPhaseTarget:null,nextPhaseLabel:null,prevPhaseTarget:"peram",isTransfer:!0,phaseKey:"semai_tray"}];return a.jsxs(da,{header:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold text-gray-900 tracking-tight",children:"Manajemen Semai"}),a.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Kelola pembibitan dari perendaman hingga pindah tanam"})]}),a.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary gap-1.5",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),"Tanam Baru"]})]}),children:[a.jsx(oa,{title:"Manajemen Semai"}),a.jsx("div",{className:"page-container",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:la.map((e,i)=>a.jsxs("div",{className:`kanban-column animate-fade-in-up stagger-${i+1}`,style:{opacity:0},children:[a.jsxs("div",{className:"column-header",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-[10px] font-bold text-gray-300",children:e.step}),a.jsx("span",{className:"column-title",children:e.title})]}),a.jsx("span",{className:"column-count",children:e.items.length})]}),a.jsxs("div",{className:"space-y-3",children:[e.items.length===0&&a.jsxs("div",{className:"empty-state !py-8",children:[a.jsx("svg",{className:"empty-icon",fill:"none",stroke:"currentColor",strokeWidth:"1",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0l-3-3m3 3l3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})}),a.jsx("span",{className:"empty-text",children:"Kosong"})]}),e.items.map(s=>a.jsxs("div",{className:"kanban-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-2.5",children:a.jsxs("div",{className:"flex gap-1",children:[a.jsx("button",{onClick:()=>sa(s),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:a.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),a.jsx("button",{onClick:()=>na(s.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:a.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})})]})}),a.jsx("h4",{className:"text-sm font-bold text-gray-900 mb-1",children:T(s)}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 mb-1",children:[a.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 7.125C2.25 6.504 2.754 6 3.375 6h6c.621 0 1.125.504 1.125 1.125v3.75c0 .621-.504 1.125-1.125 1.125h-6a1.125 1.125 0 01-1.125-1.125v-3.75zM14.25 8.625c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v8.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 01-1.125-1.125v-8.25z"})}),a.jsxs("span",{children:[s.jumlah_tanaman," tanaman"]})]}),a.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-gray-400 mb-3",children:[a.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"})]}),a.jsx("span",{children:s.lokasi_saat_ini?.nama_lokasi})]}),a.jsx(ca,{startTime:s.tanggal_ubah_fase||s.tanggal_mulai,phaseName:e.title,serverTime:H}),a.jsx("div",{className:"flex gap-2 mt-4",children:e.isTransfer?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>L(s,e.prevPhaseTarget),disabled:y,className:"btn btn-secondary text-xs !py-2",title:"Kembalikan fase",children:a.jsx("svg",{className:"w-3.5 h-3.5 rotate-180",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"})})}),a.jsx("button",{onClick:()=>ra(s),className:"btn btn-primary flex-1 text-xs !py-2",children:"Pindah Tanam"})]}):a.jsxs(a.Fragment,{children:[e.prevPhaseTarget&&a.jsx("button",{onClick:()=>L(s,e.prevPhaseTarget),disabled:y,className:"btn btn-secondary text-xs !py-2",title:"Kembalikan fase",children:a.jsx("svg",{className:"w-3.5 h-3.5 rotate-180",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"})})}),e.nextPhaseTarget&&a.jsxs("button",{onClick:()=>L(s,e.nextPhaseTarget),disabled:y,className:"btn btn-primary flex-1 text-xs !py-2",children:[e.nextPhaseLabel,a.jsx("svg",{className:"w-3.5 h-3.5 ml-1",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"})})]})]})})]},s.id))]})]},e.key))})}),a.jsx(g,{show:I,onClose:()=>c(!1),children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Batch Tanam Baru"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Mulai siklus tanam baru dari tahap perendaman"})]}),a.jsxs("form",{onSubmit:aa,encType:"multipart/form-data",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx(n,{htmlFor:"nama_tanaman",value:"Nama Tanam / Varietas"}),a.jsx(l,{id:"nama_tanaman",type:"text",value:j.nama_tanaman,onChange:e=>f("nama_tanaman",e.target.value),className:"input-field mt-1.5",placeholder:"Contoh: Selada Romaine",required:!0}),a.jsx(r,{message:b.nama_tanaman,className:"mt-2"})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx(n,{htmlFor:"nama_lokasi",value:"Lokasi Semai"}),a.jsx(l,{id:"nama_lokasi",list:"semai_list",value:j.nama_lokasi,onChange:e=>f("nama_lokasi",e.target.value),className:"input-field mt-1.5",placeholder:"Contoh: Meja A1",required:!0}),a.jsx("datalist",{id:"semai_list",children:_.semai.map(e=>a.jsx("option",{value:e.nama_lokasi},e.id))}),a.jsx(r,{message:b.nama_lokasi,className:"mt-2"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx(n,{htmlFor:"jumlah_tanaman",value:"Jumlah Tanaman"}),a.jsx(l,{id:"jumlah_tanaman",type:"number",value:j.jumlah_tanaman,onChange:e=>f("jumlah_tanaman",e.target.value),className:"mt-1.5",placeholder:"Contoh: 100",required:!0}),a.jsx(r,{message:b.jumlah_tanaman,className:"mt-2"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>c(!1),className:"btn btn-secondary",children:"Batal"}),a.jsx("button",{type:"submit",disabled:P,className:"btn btn-primary",children:P?"Menyimpan...":"Simpan & Mulai"})]})]})]})}),a.jsx(g,{show:W,onClose:()=>u(!1),children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Edit Batch Tanam"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Sesuaikan detail tanaman atau jumlah"})]}),a.jsxs("form",{onSubmit:ta,children:[a.jsxs("div",{className:"mb-4",children:[a.jsx(n,{htmlFor:"edit_nama",value:"Nama Tanam / Varietas"}),a.jsx(l,{id:"edit_nama",type:"text",value:w.nama_custom,onChange:e=>k("nama_custom",e.target.value),className:"input-field mt-1.5",required:!0}),a.jsx(r,{message:C.nama_custom,className:"mt-2"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx(n,{htmlFor:"edit_jumlah",value:"Jumlah Tanaman"}),a.jsx(l,{id:"edit_jumlah",type:"number",value:w.jumlah_tanaman,onChange:e=>k("jumlah_tanaman",e.target.value),className:"mt-1.5",required:!0}),a.jsx(r,{message:C.jumlah_tanaman,className:"mt-2"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn btn-secondary",children:"Batal"}),a.jsx("button",{type:"submit",disabled:M,className:"btn btn-primary",children:M?"Menyimpan...":"Perbarui"})]})]})]})}),a.jsx(g,{show:q,onClose:()=>x(!1),children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Pindah Tanam"}),t&&a.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Batch ",a.jsx("span",{className:"font-mono font-medium text-gray-600",children:t.kode_batch})," â€” ",T(t)]})]}),a.jsxs("form",{onSubmit:ia,children:[a.jsxs("div",{className:"mb-4",children:[a.jsx(n,{htmlFor:"lokasi_tujuan_id",value:"Lokasi Tujuan (Produksi)"}),a.jsxs("select",{id:"lokasi_tujuan_id",value:S.lokasi_tujuan_id,onChange:e=>N("lokasi_tujuan_id",e.target.value),className:"input-field mt-1.5",required:!0,children:[a.jsx("option",{value:"",children:"Pilih lokasi produksi..."}),_.produksi.map(e=>a.jsxs("option",{value:e.id,children:[e.nama_lokasi," (Kapasitas: ",e.kapasitas,")"]},e.id))]}),a.jsx(r,{message:D.lokasi_tujuan_id,className:"mt-2"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx(n,{htmlFor:"jumlah_tanaman_hidup",value:"Jumlah Tanaman Hidup"}),a.jsx(l,{id:"jumlah_tanaman_hidup",type:"number",value:S.jumlah_tanaman_hidup,onChange:e=>N("jumlah_tanaman_hidup",e.target.value),className:"mt-1.5",required:!0}),a.jsxs("p",{className:"mt-1.5 text-[11px] text-gray-400",children:["Jumlah sebelumnya: ",a.jsx("span",{className:"font-semibold text-gray-600",children:t?.jumlah_tanaman})]}),a.jsx(r,{message:D.jumlah_tanaman_hidup,className:"mt-2"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn btn-secondary",children:"Batal"}),a.jsx("button",{type:"submit",disabled:B,className:"btn btn-primary",children:B?"Memproses...":"Konfirmasi"})]})]})]})}),a.jsx(g,{show:K,onClose:()=>h(!1),children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Pindah Fase"}),t&&a.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Pindahkan ",a.jsx("span",{className:"font-semibold",children:T(t)})," ke fase ",a.jsx("span",{className:"capitalize font-semibold",children:p?.replace("_"," ")})]})]}),a.jsxs("form",{onSubmit:ea,children:[a.jsxs("div",{className:"mb-6",children:[a.jsx(n,{htmlFor:"phase_nama_lokasi",value:"Lokasi Baru"}),a.jsx(l,{id:"phase_nama_lokasi",list:"phase_list",value:G.nama_lokasi,onChange:e=>E("nama_lokasi",e.target.value),className:"input-field mt-1.5",placeholder:"Pilih atau ketik lokasi baru...",required:!0}),a.jsx("datalist",{id:"phase_list",children:p&&_[p==="persiapan_benih"?"semai":p==="peram"?"pemeraman":"semai_tray"]?.map(e=>a.jsx("option",{value:e.nama_lokasi},e.id))}),a.jsx(r,{message:X.nama_lokasi,className:"mt-2"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn btn-secondary",children:"Batal"}),a.jsx("button",{type:"submit",disabled:F,className:"btn btn-primary",children:F?"Memproses...":"Simpan"})]})]})]})})]})}export{ka as default};
